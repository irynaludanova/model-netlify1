---
layout: base.liquid
permalink: /add-profile/index.html
eleventyComputed:
  seo_title: '{{site.name3}} — {{site.name}}'
  seo_description: '{{site.description3}}'
  seo_og_title: '{{site.name3}} — {{site.name}}'
  seo_og_description: '{{site.description3}}'
  seo_og_image: '{{site.url}}{{site.seo_og_image}}'
  seo_og_url: '{{site.url}}/add-profile'
  seo_twitter_title: '{{site.name3}} — {{site.name}}'
  seo_twitter_description: '{{site.description3}}'
  seo_twitter_image: '{{site.url}}{{site.seo_og_image}}'
  seo_canonical: '{{site.url}}/add-profile'
  seo_json_ld:
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": '{{site.name3}}',
      "url":  '{{site.url}}/add-profile',
      "description": '{{site.description3}}'
    }
---
<script>
const form = document.querySelector("form");
form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const data = {
    name: form.name.value,
    city: form.city.value,
    category: form.category.value,
    description: form.description.value,
    age: form.age.value,
    email: form.email.value,
    phone: form.phone.value,
    image: "/img/placeholder.png"
  };

  const res = await fetch("/.netlify/functions/add-profile", {
    method: "POST",
    body: JSON.stringify(data),
  });

  if (res.ok) {
    window.location.href = "/submit-profile/";
  } else {
    alert("Ошибка при отправке формы");
  }
});
</script>
<script type="module">

  async function cloudinaryUpload(file) {
    const form = new FormData();
    form.append('file', file);
    form.append('upload_preset', 'unsigned_profiles');
    const res = await fetch('https://api.cloudinary.com/v1_1/dimallvw3/upload', {
      method: 'POST',
      body: form
    });
    const data = await res.json();
    if (!res.ok) throw new Error('Cloudinary upload failed: ' + JSON.stringify(data));
    return data.secure_url;
  }

  document.querySelector('#add-profile-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const fd = new FormData(form);
    const name = fd.get('name');


    let image_url = '';
    const file = fd.get('image');
    if (file && file.size) {
      try {
        image_url = await cloudinaryUpload(file);
      } catch (err) {
        alert('Ошибка загрузки изображения: ' + err.message);
        return;
      }
    }

    const payload = {
      name,
      city: fd.get('city'),
      category: fd.get('category'),
      description: fd.get('description'),
      age: fd.get('age'),
      email: fd.get('email'),
      phone: fd.get('phone'),
      image_url
    };


    const resp = await fetch('/.netlify/functions/add-profile', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    if (!resp.ok) {
      const text = await resp.text();
      alert('Ошибка сервера: ' + text);
      return;
    }

    const result = await resp.json();
    alert('Профиль добавлен!');
    form.reset();
  });
</script>

<div class="add-profile-section">
  <h1>Добавить профиль</h1>
  <form name="add-profile"
      method="POST"
      netlify
    action="/.netlify/functions/add-profile"
     id="add-profile-form"
      enctype="multipart/form-data">
  <input type="hidden" name="form-name" value="add-profile" />

  <div class="form-group">
    <label for="name">Имя:</label>
    <input type="text" id="name" name="name" required />
  </div>

  <div class="form-group">
    <label for="city">Город:</label>
    <select id="city" name="city" required>
      <option value="Майами-Бич">Майами-Бич</option>
      <option value="Халландейл">Халландейл</option>
      <option value="Корал-Гейблс">Корал-Гейблс</option>
    </select>
  </div>

  <div class="form-group">
    <label for="category">Категория:</label>
    <select id="category" name="category" required>
      <option value="Модель">Модель</option>
      <option value="Фотограф">Фотограф</option>
      <option value="Стилист">Стилист</option>
    </select>
  </div>

  <div class="form-group">
    <label for="description">Описание:</label>
    <textarea id="description" name="description" required></textarea>
  </div>

  <div class="form-group">
    <label for="age">Возраст:</label>
    <input type="number" id="age" name="age" required />
  </div>

  <div class="form-group">
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required />
  </div>

  <div class="form-group">
    <label for="phone">Телефон (опционально):</label>
    <input type="tel" id="phone" name="phone" />
  </div>

  <div class="form-group">
    <label for="image">Фото профиля:</label>
    <input type="file" name="image" accept="image/*" required />
    <p class="form-note">Рекомендуемый размер: 300x300px, формат: JPG, PNG, WEBP.</p>
  </div>

  <button type="submit">Отправить</button>
</form>

</div>

